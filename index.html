<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chalamandra HUB | Singularidad</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap');
        body, html { margin: 0; padding: 0; background: #050505; color: #00ff88; font-family: 'Space Grotesk', sans-serif; overflow: hidden; }
        
        /* Canvas de Matrix */
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; opacity: 0; transition: opacity 2s; pointer-events: none; }
        
        .ui-layer { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: radial-gradient(circle, rgba(0,255,136,0.05) 0%, transparent 80%); }
        
        .panel { 
            text-align: center; padding: 3rem; border: 1px solid rgba(0, 255, 136, 0.3);
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px);
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.1); border-radius: 2px;
        }

        .masa-critica { font-size: 5rem; font-weight: 700; text-shadow: 0 0 20px #00ff88; margin: 20px 0; }
        .status-bar { font-family: monospace; font-size: 0.9rem; letter-spacing: 2px; border-top: 1px solid #333; padding-top: 10px; color: #888; }
        
        /* Animación de Alerta */
        .glitch-active { animation: shake 0.5s infinite; color: #fff !important; text-shadow: 0 0 30px #00ff88, 0 0 60px #00ff88 !important; }
        @keyframes shake { 0% { transform: translate(0,0); } 20% { transform: translate(-2px,2px); } 40% { transform: translate(-2px,-2px); } 60% { transform: translate(2px,2px); } 80% { transform: translate(2px,-2px); } 100% { transform: translate(0,0); } }
    </style>
</head>
<body>

    <canvas id="matrix-canvas"></canvas>

    <div class="ui-layer">
        <div class="panel" id="main-panel">
            <div style="font-size: 0.8rem; letter-spacing: 5px;">ESTADO: SINGULARIDAD PRIVADA</div>
            <div class="masa-critica" id="display-masa">$0.00</div>
            <div class="status-bar" id="status-text">ESPERANDO INYECCIÓN DE MATERIA...</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        let statusText = document.getElementById('status-text');
        let masaDisplay = document.getElementById('display-masa');

        // Configuración Lluvia de Matrix
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()*&^%";
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#0f0";
            ctx.font = fontSize + "px monospace";
            for (let i = 0; i < drops.length; i++) {
                const text = letters.charAt(Math.floor(Math.random() * letters.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }

        let matrixInterval;

        async function checkStatus() {
            try {
                const res = await fetch('cloud_snapshot.json?t=' + Date.now());
                const data = await res.json();
                
                // Actualizar Monto
                masaDisplay.innerText = parseFloat(data.masa_critica).toLocaleString('en-US', { style: 'currency', currency: 'USD' });

                // Disparar Efecto si hay Glitch
                if (data.glitch === true) {
                    activateGlitch();
                }
            } catch (e) {}
        }

        function activateGlitch() {
            canvas.style.opacity = "1";
            document.getElementById('main-panel').classList.add('glitch-active');
            statusText.innerText = "¡ALERTA! MASA CRÍTICA DETECTADA - SINCRONIZANDO...";
            if(!matrixInterval) matrixInterval = setInterval(drawMatrix, 5000); // Lluvia lenta/persistente
            
            setTimeout(() => {
                canvas.style.opacity = "0";
                document.getElementById('main-panel').classList.remove('glitch-active');
                statusText.innerText = "SINGULARIDAD ESTABLEIZADA.";
            }, 10000); // El efecto dura 10 segundos
        }

        setInterval(checkStatus, 3000);
        checkStatus();
    </script>
</body>
</html>
